<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>ZeroD documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">ZeroD documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">







<ol class="breadcrumb">
  <li>Injectables</li>
  <li>CloudserviceService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/servicios/cloudservice.service.ts</code>
        </p>




            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#accidenteCollection">accidenteCollection</a>
                            </li>
                            <li>
                                <a href="#isConnected">isConnected</a>
                            </li>
                            <li>
                                <a href="#lastAccidentLoaded">lastAccidentLoaded</a>
                            </li>
                            <li>
                                <a href="#lastlastAccidentLoaded">lastlastAccidentLoaded</a>
                            </li>
                            <li>
                                <a href="#lastlastMeteorologyLoaded">lastlastMeteorologyLoaded</a>
                            </li>
                            <li>
                                <a href="#lastMeteorologyLoaded">lastMeteorologyLoaded</a>
                            </li>
                            <li>
                                <a href="#meteorologiaCollection">meteorologiaCollection</a>
                            </li>
                            <li>
                                <a href="#scrollAccidentEnabled">scrollAccidentEnabled</a>
                            </li>
                            <li>
                                <a href="#scrollMeteorologyEnabled">scrollMeteorologyEnabled</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#anadirA">anadirA</a>
                            </li>
                            <li>
                                <a href="#anadirM">anadirM</a>
                            </li>
                            <li>
                                <a href="#getAccident">getAccident</a>
                            </li>
                            <li>
                                <a href="#getMarkAccident">getMarkAccident</a>
                            </li>
                            <li>
                                <a href="#getMarkMeteorology">getMarkMeteorology</a>
                            </li>
                            <li>
                                <a href="#getMeteorology">getMeteorology</a>
                            </li>
                            <li>
                                <a href="#isInfinityScrollEnabled">isInfinityScrollEnabled</a>
                            </li>
                            <li>
                                <a href="#misInfinityScrollEnabled">misInfinityScrollEnabled</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(fireStore: AngularFirestore)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="28" class="link-to-prism">src/app/servicios/cloudservice.service.ts:28</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>fireStore</td>
                                                  
                                                        <td>
                                                                    <code>AngularFirestore</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="anadirA"></a>
                    <span class="name">
                        <b>
                            anadirA
                        </b>
                        <a href="#anadirA"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>anadirA(datos)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="46"
                            class="link-to-prism">src/app/servicios/cloudservice.service.ts:46</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Recibe un objeto y lo guarda como un documento nuevo en la colección &#39;accidente&#39;
Devuelve un Promise</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>datos</td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>documento a insertar en firebase</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        <p>Devuelve un promise</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="anadirM"></a>
                    <span class="name">
                        <b>
                            anadirM
                        </b>
                        <a href="#anadirM"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>anadirM(datos)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="173"
                            class="link-to-prism">src/app/servicios/cloudservice.service.ts:173</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Recibe un objeto y lo guarda como un documento nuevo en la colección &#39;meteorologia&#39;
Devuelve un Promise</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>datos</td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>documento a insertar en firebase</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        <p>Devuelve un promise</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getAccident"></a>
                    <span class="name">
                        <b>
                            getAccident
                        </b>
                        <a href="#getAccident"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getAccident(reload?)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="72"
                            class="link-to-prism">src/app/servicios/cloudservice.service.ts:72</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Carga de accidentes en caso de no estar presente la variable reload, se añaden los siguientes 15 al final de la lista </p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>reload</td>

                                    <td>
                                        Yes
                                    </td>


                                    <td>
                                        <p>evento que acciona la carga de mas elementos a la lista</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/iAccidente.html" target="_self" >Promise&lt;iAccidente[]&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getMarkAccident"></a>
                    <span class="name">
                        <b>
                            getMarkAccident
                        </b>
                        <a href="#getMarkAccident"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getMarkAccident()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="127"
                            class="link-to-prism">src/app/servicios/cloudservice.service.ts:127</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/iAccidente.html" target="_self" >Promise&lt;iAccidente[]&gt;</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getMarkMeteorology"></a>
                    <span class="name">
                        <b>
                            getMarkMeteorology
                        </b>
                        <a href="#getMarkMeteorology"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getMarkMeteorology()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="253"
                            class="link-to-prism">src/app/servicios/cloudservice.service.ts:253</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Carga las marcas de meteorologia en el mapa. Como maximo se van a maracar 1000 marcas</p>
</div>

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/iMeteorology.html" target="_self" >Promise&lt;iMeteorology[]&gt;</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getMeteorology"></a>
                    <span class="name">
                        <b>
                            getMeteorology
                        </b>
                        <a href="#getMeteorology"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getMeteorology(reload?)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="197"
                            class="link-to-prism">src/app/servicios/cloudservice.service.ts:197</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Carga de accidentes en caso de no estar presente la variable reload, se añaden los siguientes 15 al final de la lista</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>reload</td>

                                    <td>
                                        Yes
                                    </td>


                                    <td>
                                        <p>evento que acciona la carga de mas elementos a la lista</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/iMeteorology.html" target="_self" >Promise&lt;iMeteorology[]&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isInfinityScrollEnabled"></a>
                    <span class="name">
                        <b>
                            isInfinityScrollEnabled
                        </b>
                        <a href="#isInfinityScrollEnabled"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>isInfinityScrollEnabled()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="63"
                            class="link-to-prism">src/app/servicios/cloudservice.service.ts:63</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Habilita el scroll para la pestaña accidentes</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                    </div>
                    <div class="io-description">
                        <p>devuelve si se ha habilitado el scroll</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="misInfinityScrollEnabled"></a>
                    <span class="name">
                        <b>
                            misInfinityScrollEnabled
                        </b>
                        <a href="#misInfinityScrollEnabled"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>misInfinityScrollEnabled()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="188"
                            class="link-to-prism">src/app/servicios/cloudservice.service.ts:188</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Habilita el scroll para la pestaña meteorologia</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                    </div>
                    <div class="io-description">
                        <p>devuelve si se ha habilitado el scroll</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="accidenteCollection"></a>
                        <span class="name">
                            <b>
                            accidenteCollection</b>
                            <a href="#accidenteCollection"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>AngularFirestoreCollection&lt;any&gt;</code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="13" class="link-to-prism">src/app/servicios/cloudservice.service.ts:13</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="isConnected"></a>
                        <span class="name">
                            <b>
                            isConnected</b>
                            <a href="#isConnected"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>true</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="28" class="link-to-prism">src/app/servicios/cloudservice.service.ts:28</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="lastAccidentLoaded"></a>
                        <span class="name">
                            <b>
                            lastAccidentLoaded</b>
                            <a href="#lastAccidentLoaded"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>null</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>null</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="19" class="link-to-prism">src/app/servicios/cloudservice.service.ts:19</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="lastlastAccidentLoaded"></a>
                        <span class="name">
                            <b>
                            lastlastAccidentLoaded</b>
                            <a href="#lastlastAccidentLoaded"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>null</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>null</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="20" class="link-to-prism">src/app/servicios/cloudservice.service.ts:20</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="lastlastMeteorologyLoaded"></a>
                        <span class="name">
                            <b>
                            lastlastMeteorologyLoaded</b>
                            <a href="#lastlastMeteorologyLoaded"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>null</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>null</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="25" class="link-to-prism">src/app/servicios/cloudservice.service.ts:25</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="lastMeteorologyLoaded"></a>
                        <span class="name">
                            <b>
                            lastMeteorologyLoaded</b>
                            <a href="#lastMeteorologyLoaded"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>null</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>null</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="24" class="link-to-prism">src/app/servicios/cloudservice.service.ts:24</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="meteorologiaCollection"></a>
                        <span class="name">
                            <b>
                            meteorologiaCollection</b>
                            <a href="#meteorologiaCollection"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>AngularFirestoreCollection&lt;any&gt;</code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="14" class="link-to-prism">src/app/servicios/cloudservice.service.ts:14</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="scrollAccidentEnabled"></a>
                        <span class="name">
                            <b>
                            scrollAccidentEnabled</b>
                            <a href="#scrollAccidentEnabled"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>true</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="21" class="link-to-prism">src/app/servicios/cloudservice.service.ts:21</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="scrollMeteorologyEnabled"></a>
                        <span class="name">
                            <b>
                            scrollMeteorologyEnabled</b>
                            <a href="#scrollMeteorologyEnabled"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>true</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="26" class="link-to-prism">src/app/servicios/cloudservice.service.ts:26</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { iMeteorology } from &#x27;./../model/iMeteorology&#x27;;
import { iAccidente } from &#x27;./../model/iAccident&#x27;;
import { Injectable } from &#x27;@angular/core&#x27;;
import { AngularFirestore, AngularFirestoreCollection } from &#x27;angularfire2/firestore&#x27;;
import { environment } from &#x27;../../environments/environment&#x27;;

@Injectable({
  providedIn: &#x27;root&#x27;
})
export class CloudserviceService {
  //Variables para las colecciones de firestore

  accidenteCollection: AngularFirestoreCollection&lt;any&gt;;
  meteorologiaCollection: AngularFirestoreCollection&lt;any&gt;;
  
  

  /*Variables para el infiniteScroll de la pestaña Accidentes*/
  lastAccidentLoaded &#x3D; null;  //último accidente cargado
  lastlastAccidentLoaded &#x3D; null;  //último cargado esta vez, si es igual al anterior, entonces no hay más que cargar
  scrollAccidentEnabled &#x3D; true;  //está el infiniteScroll habilitado porque se haya cumplido lo anterior

  /*Variables para el infiniteScroll de la pestaña Meteorologia*/
  lastMeteorologyLoaded &#x3D; null;  //último accidente cargado
  lastlastMeteorologyLoaded &#x3D; null;  //último cargado esta vez, si es igual al anterior, entonces no hay más que cargar
  scrollMeteorologyEnabled &#x3D; true;  //está el infiniteScroll habilitado porque se haya cumplido lo anterior

  isConnected &#x3D; true;  //saber si estamos con red para realizar conexiones

  constructor(private fireStore: AngularFirestore) {
    /* Crea una referencia a la colección que empleamos para realizar las
    operaciones CRUD*/
    this.accidenteCollection &#x3D; fireStore.collection&lt;any&gt;(environment.accidenteColeccion);
    this.meteorologiaCollection &#x3D; fireStore.collection&lt;any&gt;(environment.meteorologiaColeccion);
    


  }
  /**
   * Recibe un objeto y lo guarda como un documento nuevo en la colección &#x27;accidente&#x27;
   * Devuelve un Promise
   * @param datos documento a insertar en firebase
   * @return Devuelve un promise
   */
  
  anadirA(datos) {
    
    return this.accidenteCollection.add(datos).then(e &#x3D;&gt;{

      console.log(&quot;Todo ok&quot;)
    }).catch(err &#x3D;&gt;{

      console.log(err);
    });
  }


  /**
   * Habilita el scroll para la pestaña accidentes
   * @returns devuelve si se ha habilitado el scroll
   */
  
  isInfinityScrollEnabled() {
    return this.scrollAccidentEnabled;
  }


  /**
   * Carga de accidentes en caso de no estar presente la variable reload, se añaden los siguientes 15 al final de la lista 
   * @param reload evento que acciona la carga de mas elementos a la lista
    */
  getAccident(reload?): Promise&lt;iAccidente[]&gt; {
    if (reload) {
      this.lastlastAccidentLoaded &#x3D; null;
      this.scrollAccidentEnabled &#x3D; true;
    }
    this.lastAccidentLoaded &#x3D; this.lastlastAccidentLoaded;
    return new Promise((resolve, reject) &#x3D;&gt; {
      let lreq: iAccidente[] &#x3D; [];
      let query;
      if (this.lastAccidentLoaded &#x3D;&#x3D; null) {
        /* Obtengo los primeros 15 accidentes ordenados por descripcion. Para ordenar es necesario
        activar un índice en firebase. Si no se crea dará un error por consola indicando los pasos
        necesarios para crearlo */
        query &#x3D; this.accidenteCollection.ref.orderBy(&quot;hora&quot;, &quot;asc&quot;).limit(15).get();

      } else {
        /* Cargamos 15 a partir del último cargado */
        query &#x3D; this.accidenteCollection.ref.orderBy(&quot;hora&quot;, &quot;asc&quot;).startAfter(this.lastAccidentLoaded).limit(15).get();
      }
      query.then((d) &#x3D;&gt; {
        d.forEach((u) &#x3D;&gt; {
          let x &#x3D; { &quot;hora&quot;: u.id, ...u.data() };
          /*Unicamente ase van a añadir a la vista las alertas que lleven menos de una hora, por defecto estas no se mostraran y si
          el aviso sigue estando en el lugar de los hechos basta con volvera a crear la alerta*/
          let horaLocal &#x3D; new Date().valueOf();

          if(x.hora+3600000 &lt;&#x3D; horaLocal){

            this.accidenteCollection.doc(u.id).delete().then(e &#x3D;&gt; {
              console.log(&quot;Document successfully deleted!&quot;);
          }).catch(function(error) {
              console.error(&quot;Error removing document: &quot;, error);
          });

          }else{
  
            lreq.push(x);

          }

          
        });
        this.lastlastAccidentLoaded &#x3D; d.docs[d.docs.length - 1];
        if (d.docs.length &lt; 10) {
          this.scrollAccidentEnabled &#x3D; false;
        }
        
        
        resolve(lreq);

      })
    })
  }

  /* Carga de accidentes en el mapa (Crea los marcadores) unicamente se mostraran hasta 1000 avisos*/
  getMarkAccident(): Promise&lt;iAccidente[]&gt;{

    return new Promise((resolve, reject) &#x3D;&gt; {
      let lreq: iAccidente[] &#x3D; [];
      let query;
 
      query &#x3D; this.accidenteCollection.ref.orderBy(&quot;hora&quot;, &quot;asc&quot;).limit(1000).get();

      
      query.then((d) &#x3D;&gt; {
        d.forEach((u) &#x3D;&gt; {
          let x &#x3D; { &quot;hora&quot;: u.id, ...u.data() };
          /*Unicamente ase van a añadir a la vista las alertas que lleven menos de una hora, por defecto estas no se mostraran y si
          el aviso sigue estando en el lugar de los hechos basta con volvera a crear la alerta*/

          let horaLocal &#x3D; new Date().valueOf();

          if(x.hora+3600000&lt;&#x3D; horaLocal){

            this.accidenteCollection.doc(u.id).delete().then(e &#x3D;&gt; {
              console.log(&quot;Document successfully deleted!&quot;);
          }).catch(function(error) {
              console.error(&quot;Error removing document: &quot;, error);
          });
          }else{

            lreq.push(x);

          }
        });
        
        
        resolve(lreq);

      })
    })

  }

/**
 *  Recibe un objeto y lo guarda como un documento nuevo en la colección &#x27;meteorologia&#x27;
  Devuelve un Promise
  @param datos documento a insertar en firebase
  @return Devuelve un promise
 */
 
  anadirM(datos) {
    return this.meteorologiaCollection.add(datos).then(e &#x3D;&gt;{

      console.log(&quot;Todo ok&quot;)
    }).catch(err &#x3D;&gt;{

      console.log(err);
    });
  }


  /**
   * Habilita el scroll para la pestaña meteorologia
   * @returns devuelve si se ha habilitado el scroll
   *  */
  misInfinityScrollEnabled() {
    return this.scrollMeteorologyEnabled;
  }

  /**
   * Carga de accidentes en caso de no estar presente la variable reload, se añaden los siguientes 15 al final de la lista
   *  @param reload evento que acciona la carga de mas elementos a la lista
   */
   
   getMeteorology(reload?): Promise&lt;iMeteorology[]&gt; {
    if (reload) {
      this.lastlastMeteorologyLoaded &#x3D; null;
      this.scrollMeteorologyEnabled &#x3D; true;
    }
    this.lastMeteorologyLoaded &#x3D; this.lastlastMeteorologyLoaded;
    return new Promise((resolve, reject) &#x3D;&gt; {
      let lreq: iMeteorology[] &#x3D; [];
      let query;
      if (this.lastMeteorologyLoaded &#x3D;&#x3D; null) {
        /* Obtengo los primeros 15 eventos de meteorologia ordenados por descripcion. Para ordenar es necesario
        activar un índice en firebase. Si no se crea dará un error por consola indicando los pasos
        necesarios para crearlo */
        query &#x3D; this.meteorologiaCollection.ref.orderBy(&quot;hora&quot;, &quot;asc&quot;).limit(15).get();

      } else {
        /* Cargamos 15 a partir del último cargado */
        query &#x3D; this.meteorologiaCollection.ref.orderBy(&quot;hora&quot;, &quot;asc&quot;).startAfter(this.lastMeteorologyLoaded).limit(15).get();
      }
      query.then((d) &#x3D;&gt; {
        d.forEach((u) &#x3D;&gt; {
          let x &#x3D; { &quot;hora&quot;: u.id, ...u.data() };
          let horaLocal &#x3D; new Date().valueOf();

          /*Unicamente ase van a añadir a la vista las alertas que lleven menos de una hora, por defecto estas no se mostraran y si
          el aviso sigue estando en el lugar de los hechos basta con volvera a crear la alerta*/

          if(x.hora+3600000&lt;&#x3D; horaLocal){
            //Se elimina ese aviso
            this.meteorologiaCollection.doc(u.id).delete().then(e &#x3D;&gt; {
              console.log(&quot;Document successfully deleted!&quot;);
          }).catch(function(error) {
              console.error(&quot;Error removing document: &quot;, error);
          });

          }else{
            
            lreq.push(x);
          }
        });
        this.lastlastMeteorologyLoaded &#x3D; d.docs[d.docs.length - 1];
        if (d.docs.length &lt; 10) {
          this.scrollMeteorologyEnabled &#x3D; false;
        }
        
        
        resolve(lreq);

      })
    })
  }


/**
 *  Carga las marcas de meteorologia en el mapa. Como maximo se van a maracar 1000 marcas
 * */
  getMarkMeteorology(): Promise&lt;iMeteorology[]&gt;{

   
    return new Promise((resolve, reject) &#x3D;&gt; {
      let lreq: iMeteorology[] &#x3D; [];
      let query;
      
        
      query &#x3D; this.meteorologiaCollection.ref.orderBy(&quot;hora&quot;, &quot;asc&quot;).limit(1000).get();

      
      query.then((d) &#x3D;&gt; {
        d.forEach((u) &#x3D;&gt; {
          let x &#x3D; { &quot;hora&quot;: u.id, ...u.data() };
         
          let horaLocal &#x3D; new Date().valueOf();
/*Unicamente ase van a añadir a la vista las alertas que lleven menos de una hora, por defecto estas no se mostraran y si
          el aviso sigue estando en el lugar de los hechos basta con volvera a crear la alerta*/

          if(x.hora+3600000&lt;&#x3D; horaLocal){
           
            this.meteorologiaCollection.doc(u.id).delete().then(e &#x3D;&gt; {
              console.log(&quot;Document successfully deleted!&quot;);
          }).catch(function(error) {
              console.error(&quot;Error removing document: &quot;, error);
          });
          
          }else{
           
            lreq.push(x);

          }
        });
        
        
        resolve(lreq);

      })
    })

  }

}
</code></pre>
    </div>

</div>











                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'CloudserviceService.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
